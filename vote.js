function getAccessToken(){const h=window.location.hash.substring(1);return new URLSearchParams(h).get('access_token')}async function fetchDiscordUser(t){const r=await fetch('https://discord.com/api/users/@me',{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error('失敗');return r.json()}async function init(){const t=getAccessToken();if(!t)return document.getElementById('login-status').innerHTML='<a href="login.html">請先登入</a>';try{const u=await fetchDiscordUser(t);document.getElementById('login-status').innerText=`歡迎，${u.username}`;const d=firebase.database().ref('candidates');d.once('value',s=>{const c=s.val(),l=document.getElementById('candidate-list');l.innerHTML='';for(const[i,o]of Object.entries(c))l.innerHTML+=`<li><button onclick="vote('${i}')">${o.name}</button></li>`})}catch(e){document.getElementById('login-status').innerText='登入失敗'}}function vote(i){const u=firebase.database().ref('votes/'+i);u.set({votedAt:Date.now()},e=>{document.getElementById('vote-result').innerText=e?'失敗':'投票成功'})}init();